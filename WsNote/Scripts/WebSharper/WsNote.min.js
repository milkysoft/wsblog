(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;$.Define($$,{WsNote:{BlogUI:{main:function(){var J,K,O,X,Y;J=c.get_Do();K=J.Bind(e.op_LessMultiplyGreater(e["var'str'to'int"](0).get_View(),g["var'page'number"]().get_View()),function(L){return J.Bind(e.op_LessMultiplyGreater(e["var'str'to'int"](10).get_View(),g["var'posts'count"]().get_View()),function(M){return J.Bind(g["var'context"]().get_View(),function(N){return J.Return([L,M,N]);});});});O=c.MapAsync(function(P){var Q,R,S;Q=P[0];R=P[1];S=P[2];return h.Delay(function(){return h.Bind(i["read'page"](Q,R,S),function(U){return h.Bind(k.Async("WsNote:5",[]),function(V){var W;(l["set'logged'in"]())(V.$==1);W="render'blog "+$$.String(U.Posts.get_Value().get_Length())+" posts";if(m){m.log(W);}return h.Return(g["b'page"](U,{PageNum:Q,PageLen:R,TotlalLen:U.TotlaCount.get_Value()}));});});});},K);Y=n.Div0(o.ofArray([e.txt("\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u2116"),(e.input0())(g["var'page'number"]()),e.txt("\u041a\u043e\u043b\u043b\u0438\u0447\u0435\u0441\u0432\u043e \u0441\u0442\u0430\u0442\u0435\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435"),(e.input0())(g["var'posts'count"]()),e.txt("\u041f\u043e\u0438\u0441\u043a"),(e.input0())(g["var'context"]())]));X=n.Div0(o.ofArray([((p.on())(q.get_Empty()))(Y),q.EmbedView(O)]));return((l["on'visible"]())(l["doc'logining"]()))(X);},"\u044f\u0434\u0440\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0432\u0435\u0431 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f":{"b'nav":function(Z){var _0,_1,_2,_3;_0=Z.TotlalLen/Z.PageLen>>0;_1=r.Min(9,_0);_2=Z.PageNum<9?0:r.Max(Z.PageNum-4,0);_3=r.Min(_2+9,_0);return s.toList(s.delay(function(){return s.append(s.collect(function(_5){var _6;_6="C\u0442\u0430\u0440\u043d\u0438\u0446\u0430 "+$$.String(_5);return[n.LI0(s.toList(s.delay(function(){return _5===Z.PageNum?[n.Span(o.ofArray([t.Class("current-page")]),o.ofArray([e.txt(_6)]))]:[(e.button0(_6))(function(){return g["var'page'number"]().set_Value(u(_5));})];})))];},r.range(_2,_3)),s.delay(function(){return[n.LI0(o.ofArray([e.txt("\u0412\u0441\u0435\u0433\u043e "+$$.String(_0)+" \u0441\u0442\u0440\u0430\u043d\u0438\u0446")]))];}));}));},"b'page":function(_,ba){var be;be=function(bf){return n.UL0(o.map(function(bg){return w.doc(_,bg);},bf));};return((p.on())(p.doc(_)))(n.Div0(o.ofArray([n.Nav($.New(v,{$:0}),o.ofArray([n.UL($.New(v,{$:0}),s.toList(s.delay(function(){return s.append([n.LI0(o.ofArray([l.button()]))],s.delay(function(){return s.append([n.LI0(o.ofArray([l.protect(p.button())]))],s.delay(function(){return g["b'nav"](ba);}));}));})))])),e["Doc'Map"](c.FromVar(_.Posts),be)])));},"var'context":$.Field(function(){return x.Create("");}),"var'page'number":$.Field(function(){return x.Create("0");}),"var'posts'count":$.Field(function(){return x.Create("10");})}},ClientBlogData:{"add'post":function(bg,bh,bi){var bj,bk,bl;bj=[bg,bh,bi];bk={$:3,$0:bj[0],$1:bj[1],$2:bj[2]};bl=y.crud();bl.mailbox.AddLast(bk);return bl.resume();},"delete'post":function(bm,bn){var bo,bp,bq;bo=[bm,bn.Id];bp={$:2,$0:bo[0],$1:bo[1]};bq=y.crud();bq.mailbox.AddLast(bp);return bq.resume();},"read'page":function(br,bs,bt){return y.crud().PostAndAsyncReply(function(bu){return{$:0,$0:br,$1:bs,$2:bt,$3:bu};},{$:0});},"update'post":function(bv){var bw,bx;bw={$:1,$0:bv};bx=y.crud();bx.mailbox.AddLast(bw);return bx.resume();},"\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439":{"create'post":function(by){return{Id:by.Id,Title:x.Create(by.Title),Content:x.Create(by.Content),CreateDate:by.CreateDate,EditDate:x.Create(by.EditDate),Num:x.Create(by.Num),EditedTitle:x.Create(by.Title),EditedContent:x.Create(by.Content),IsEditMode:x.Create(false)};},crud:$.Field(function(){return A.Start(function(bz){var bA;bA=function(){return h.Delay(function(){var bD;bD=bz.Receive({$:0});return h.Bind(bD,function(bE){var bF,bG,bI,bJ,bL,bN;if(bE.$==1){bG=bE.$0;bG.IsEditMode.set_Value(false);bF=h.Bind(k.Async("WsNote:2",[bG.Id,bG.EditedTitle.get_Value(),bG.EditedContent.get_Value()]),function(bH){bG.Content.set_Value(bH.Content);bG.Title.set_Value(bH.Title);bG.EditDate.set_Value(bH.EditDate);return h.Return(null);});}else{if(bE.$==2){bI=bE.$1;bJ=bE.$0;k.Send("WsNote:1",[bI]);bJ.Posts.set_Value(o.filter(function(bK){return bI!==bK.Id;},bJ.Posts.get_Value()));bJ.TotlaCount.set_Value(bJ.TotlaCount.get_Value()-1);bF=h.Return(null);}else{if(bE.$==3){bL=bE.$0;bF=h.Bind(k.Async("WsNote:0",[bE.$1,bE.$2]),function(bM){bL.Posts.set_Value($.New(v,{$:1,$0:y["create'post"](bM),$1:bL.Posts.get_Value()}));return h.Return(null);});}else{bN=bE.$3;bF=h.Bind(k.Async("WsNote:3",[bE.$0,bE.$1,bE.$2]),function(bO){var bP;bP=bO[0];bN({Posts:x.Create(o.map(function(bQ){return y["create'post"](bQ);},bO[1])),TotlaCount:x.Create(bP)});return h.Return(null);});}}}return h.Combine(bF,h.Delay(function(){return bA(null);}));});});};return bA(null);},{$:0});}),"update'post":function(bS,bT){bS.Title.set_Value(bT.Title);bS.Content.set_Value(bT.Content);bS.EditDate.set_Value(bT.EditDate);return bS.Num.set_Value(bT.Num);}}},ClientUtils:{isNumber:function($n){var $0=this,$this=this;return!$$.isNaN($$.parseFloat($n))&&$$.isFinite($n);},"strToInt'or'zero":function($x){var $0=this,$this=this;return $$.Math.abs(~(~$x));},"|Str'Int|_|":function(bU){return u(~(~B(bU)))===bU?{$:1,$0:C["strToInt'or'zero"](bU)}:{$:0};}},LoginUI:{button:$.Field(function(){return((l["is'logged'in"]())(D["button'logout"]()))(D["button'login"]());}),"doc'logining":$.Field(function(){var bV,b1;bV=function(bW){return bW?e.txt("\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0432\u0445\u043e\u0434..."):(e.button0("\u0412\u043e\u0439\u0442\u0438"))(function(){return D.login();});};b1=function(b2){var b3;if(b2.$==1){b3=b2.$0;return n.Div(o.ofArray([t.Style("color","red")]),o.ofArray([n.H20(o.ofArray([e.txt(b3)]))]));}else{return q.get_Empty();}};return n.Div0(o.ofArray([n.H10(o.ofArray([e.txt("\u0412\u0445\u043e\u0434 \u043d\u0430 \u0441\u0430\u0439\u0442")])),n.Table0(o.ofArray([n.TR0(o.ofArray([n.TD0(o.ofArray([e.txt("\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f")])),n.TD0(o.ofArray([(e.input0())(D["var'user"]())]))])),n.TR0(o.ofArray([n.TD0(o.ofArray([e.txt("\u041f\u0430\u0440\u043e\u043b\u044c")])),n.TD0(o.ofArray([q.PasswordBox($.New(v,{$:0}),D["var'pass"]())]))]))])),n.P0(o.ofArray([e["Doc'Map"](D["var'is'loginign'process"]().get_View(),bV),(e.button0("\u041e\u0442\u043c\u0435\u043d\u0430"))(function(){var bZ,b0;D["var'is'visible"]().set_Value(false);D["var'error"]().set_Value({$:0});bZ=(D.op_SpliceUntyped())(D["key'user"]());x.Set(D["var'user"](),bZ);b0=(D.op_SpliceUntyped())(D["key'pass"]());return x.Set(D["var'pass"](),b0);})])),e["Doc'Map"](D["var'error"]().get_View(),b1)]));}),"is'logged'in":$.Field(function(){return function(b4){return function(b5){return e["doc'on'off"](D["var'is'logged'in"](),b4,b5);};};}),"on'visible":$.Field(function(){return function(b6){return function(b7){return e["doc'on'off"](D["var'is'visible"](),b6,b7);};};}),protect:function(b8){return((l["is'logged'in"]())(b8))(q.get_Empty());},"set'logged'in":$.Field(function(){var b9;b9=D["var'is'logged'in"]();return function(b_){return x.Set(b9,b_);};}),"\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b":{"button'login":$.Field(function(){return(e.button0("\u0412\u043e\u0439\u0442\u0438"))(function(){return D["go'to'logining"]();});}),"button'logout":$.Field(function(){return(e.button0("\u0412\u044b\u0445\u043e\u0434"))(function(){return h.Start(h.Delay(function(){return h.Bind(k.Async("WsNote:7",[]),function(){D["var'is'logged'in"]().set_Value(false);return h.Return(null);});}),{$:0});});}),"go'to'logining":function(){return D["var'is'visible"]().set_Value(true);},key:$.Field(function(){return"4B929568-625C-4CD0-BED4-8EACC78D21E6-blog-";}),"key'pass":$.Field(function(){return D.key()+"pass";}),"key'user":$.Field(function(){return D.key()+"user";}),localStorage:$.Field(function(){return E.localStorage;}),login:function(){return h.Start(h.Delay(function(){var ce;D["var'is'loginign'process"]().set_Value(true);ce=k.Async("WsNote:6",[D["var'user"]().get_Value(),D["var'pass"]().get_Value()]);return h.Bind(ce,function(cf){D["var'is'loginign'process"]().set_Value(false);if(cf){D["var'is'visible"]().set_Value(false);D.op_LessEqualsEquals(D["key'user"](),D["var'user"]().get_Value());D.op_LessEqualsEquals(D["key'pass"](),D["var'pass"]().get_Value());D["var'is'logged'in"]().set_Value(true);D["var'error"]().set_Value({$:0});return h.Return(null);}else{D["var'error"]().set_Value({$:1,$0:"\u041d\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c"});return h.Return(null);}});}),{$:0});},op_LessEqualsEquals:function(cg,ch){return D.localStorage().setItem(cg,ch);},op_SpliceUntyped:$.Field(function(){return function(ci){return D.localStorage().getItem(ci);};}),"var'error":$.Field(function(){return x.Create({$:0});}),"var'is'logged'in":$.Field(function(){return x.Create(false);}),"var'is'loginign'process":$.Field(function(){return x.Create(false);}),"var'is'visible":$.Field(function(){return x.Create(false);}),"var'pass":$.Field(function(){return x.Create((D.op_SpliceUntyped())(D["key'pass"]()));}),"var'user":$.Field(function(){return x.Create((D.op_SpliceUntyped())(D["key'user"]()));})}},NewPostUI:{button:$.Field(function(){return(e.button0("\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c"))(function(){return F["var'is'creating"]().set_Value(true);});}),doc:function(ck){return n.Div0(o.ofArray([n.H10(o.ofArray([e.txt("\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043d\u043e\u0432\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438")])),n.P0(o.ofArray([e.txt("\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u044c\u0438"),q.Input(o.ofArray([t.Style("width","100%")]),F["var'title"]())])),n.P0(o.ofArray([e.txt("\u0422\u0435\u043a\u0441\u0442 \u0441\u0442\u0430\u0442\u044c\u0438"),e["doc'edit'content'input'area"](F["var'content"]())])),n.P0(o.ofArray([(e.button0("\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))(function(){i["add'post"](ck,F["var'title"]().get_Value(),F["var'content"]().get_Value());return F.reset();}),(e.button0("\u041e\u0442\u043c\u0435\u043d\u0430"))(function(){return F.reset();})]))]));},on:$.Field(function(){return function(cn){return function(co){return e["doc'on'off"](F["var'is'creating"](),cn,co);};};}),"\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b":{reset:function(){F["var'title"]().set_Value("");F["var'content"]().set_Value("");return F["var'is'creating"]().set_Value(false);},"var'content":$.Field(function(){return x.Create("");}),"var'is'creating":$.Field(function(){return x.Create(false);}),"var'title":$.Field(function(){return x.Create("");})}},PostUI:{doc:function(cp,cq){var cr;cr=cq.EditedTitle;return n.LI(o.ofArray([t.Create("id","post-"+$$.String(cq.Id)+"-article")]),o.ofArray([G["doc'header"](cp,cq),G["on'edit"](cq,n.Div0(o.ofArray([n.P0(o.ofArray([e.txt("\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u044c\u0438"),q.Input(o.ofArray([t.Style("width","100%")]),cr)])),n.P0(o.ofArray([e.txt("\u0422\u0435\u043a\u0441\u0442 \u0441\u0442\u0430\u0442\u044c\u0438"),e["doc'edit'content'input'area"](cq.EditedContent)]))])),G["doc'static'content"](cq))]));},"\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b":{"doc'crud":function(cs,ct){return G["on'edit"](ct,n.Span0(o.ofArray([(e.button0("\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c"))(function(){return i["update'post"](ct);}),(e.button0("\u041e\u0442\u043c\u0435\u043d\u0430"))(function(){return ct.IsEditMode.set_Value(false);})])),l.protect(n.Span0(o.ofArray([(e.button0("\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))(function(){return i["delete'post"](cs,ct);}),(e.button0("\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))(function(){return ct.IsEditMode.set_Value(true);})]))));},"doc'date":function(cy){return n.Div(o.ofArray([t.Class("post-date-block")]),o.ofArray([e.txt("\u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f:"),e.txt(cy.CreateDate),e.txt("\u0414\u0430\u0442\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f:"),q.TextView(cy.EditDate.get_View())]));},"doc'header":function(cz,cA){var cB;cB=function(cC){return e.txt($$.String(cC));};return n.Div(o.ofArray([t.Class("post-header-block")]),o.ofArray([n.Div(o.ofArray([t.Class("post-title-text-block")]),o.ofArray([q.TextView(cA.Title.get_View())])),G["doc'crud"](cz,cA),e.txt("\u2116"),e["Doc'Map"](cA.Num.get_View(),cB),G["doc'date"](cA)]));},"doc'static'content":function(cD){var cE;cE=function(cF){var cG,cH;cG=H("<div class=\"post-content-block\">"+cF+"</div>").get(0);try{return q.Static(cG);}catch(cH){return e.txt(cF);}};return n.Div0(o.ofArray([e["Doc'Map"](cD.Content.get_View(),cE)]));},"on'edit":function(cI,cJ,cK){var cL;cL=function(cM){return cM?cJ:cK;};return e["Doc'Map"](cI.IsEditMode.get_View(),cL);}}},UINextUtils:{"Doc'Map":function(cN,cO){return q.EmbedView(c.Map(cO,cN));},addViewListener:function(cP,cQ,cR){return q.Append(cR,q.EmbedView(c.Map(function(cS){cQ(cS);return q.get_Empty();},cP)));},button0:function(cT){var cU;cU=$.New(v,{$:0});return function(cV){return q.Button(cT,cU,cV);};},"doc'edit'content'input'area":function(cW){var cX;cX=q.InputArea(o.ofArray([t.Class("edit-post-input-area")]),cW);return e.addViewListener(cW.get_View(),function(){H(".edit-post-input-area").each(function(){var cZ;this.setAttribute("style","height:5px");cZ=r.Max(this.scrollHeight,300);return this.setAttribute("style","height:"+u(cZ)+"px");});},cX);},"doc'on'off":function(c0,c1,c2){var c3;c3=function(c4){return c4?c1:c2;};return e["Doc'Map"](c.FromVar(c0),c3);},input0:$.Field(function(){var c5;c5=$.New(v,{$:0});return function(c6){return q.Input(c5,c6);};}),op_LessMultiplyGreater:function(c7,c8){return I.Apply(c7,c8);},txt:function(c9){return q.TextNode(c9);},"var'str'to'int":function(c_){return x.Create(function(c$){var da;da=C["|Str'Int|_|"](c$);return da.$==1?da.$0:c_;});}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.View);d=$.Safe($$.WsNote);e=$.Safe(d.UINextUtils);f=$.Safe(d.BlogUI);g=$.Safe(f["\u044f\u0434\u0440\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0432\u0435\u0431 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f"]);h=$.Safe($$.WebSharper.Concurrency);i=$.Safe(d.ClientBlogData);j=$.Safe($$.WebSharper.Remoting);k=$.Safe(j.AjaxRemotingProvider);l=$.Safe(d.LoginUI);m=$.Safe($$.console);n=$.Safe(b.Html);o=$.Safe($$.WebSharper.List);p=$.Safe(d.NewPostUI);q=$.Safe(b.Doc);r=$.Safe($$.WebSharper.Operators);s=$.Safe($$.WebSharper.Seq);t=$.Safe(b.Attr);u=$.Safe($$.String);v=$.Safe(o.T);w=$.Safe(d.PostUI);x=$.Safe(b.Var);y=$.Safe(i["\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438 \u043d\u0430 \u0430\u0441\u043d\u043e\u0432\u0435 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"]);z=$.Safe($$.WebSharper.Control);A=$.Safe(z.MailboxProcessor);B=$.Safe($$.Number);C=$.Safe(d.ClientUtils);D=$.Safe(l["\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b"]);E=$.Safe($$.window);F=$.Safe(p["\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b"]);G=$.Safe(w["\u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0447\u043b\u0435\u043d\u044b"]);H=$.Safe($$.jQuery);return I=$.Safe(b.View1);});$.OnLoad(function(){e.input0();F["var'title"]();F["var'is'creating"]();F["var'content"]();p.on();p.button();D["var'user"]();D["var'pass"]();D["var'is'visible"]();D["var'is'loginign'process"]();D["var'is'logged'in"]();D["var'error"]();D.op_SpliceUntyped();D.localStorage();D["key'user"]();D["key'pass"]();D.key();D["button'logout"]();D["button'login"]();l["set'logged'in"]();l["on'visible"]();l["is'logged'in"]();l["doc'logining"]();l.button();y.crud();g["var'posts'count"]();g["var'page'number"]();g["var'context"]();return;});}());
